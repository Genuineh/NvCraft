# NvCraft 配置文件格式

## 1. 概述

NvCraft 采用分层配置系统，允许用户在不同级别上进行灵活的配置。配置文件格式设计旨在简单、直观且易于管理。

## 2. 配置文件格式

NvCraft 支持多种配置文件格式，但推荐使用 YAML，因为它具有更好的可读性。

- **YAML (.yml)**: 推荐格式，简洁易读。
- **JSON (.json)**: 备选格式，适合程序化处理。

## 3. 配置层级

NvCraft 的配置分为三个层级，优先级从高到低依次为：

1.  **项目级配置 (`.nvcraft.json`)**:
    - 位于项目根目录。
    - 特定于当前项目，会覆盖全局和用户级配置。
    - 适合团队共享的项目特定设置。

2.  **用户级配置 (`~/.config/nvcraft/user_config.json`)**:
    - 用户全局配置。
    - 适用于所有项目，除非被项目级配置覆盖。

3.  **全局配置 (`~/.config/nvcraft/nvcraft_config.json`)**:
    - 全局配置，优先级低于用户配置。

4.  **默认配置**:
    - NvCraft 内置的默认配置。
    - 优先级最低。

## 4. 配置文件结构

配置文件是一个包含模块配置的映射。每个键都是模块的 `name`，值是该模块的配置。

### 示例 (`user_config.json`)

```json
{
  "theme": "catppuccin",
  "ui": {
    "font_size": 12
  },
  "completion": {
    "enable": true,
    "backend": "copilot"
  },
  "git": {
    "enable": true,
    "signs": {
      "enable": true
    }
  },
  "formatter": {
    "enable": true,
    "auto_format_on_save": true
  }
}
```

## 5. 配置加载和合并

- NvCraft 启动时，会按“默认 -> 全局 -> 用户级 -> 项目级”的顺序加载配置。
- 后加载的配置会深度合并（deep merge）到先加载的配置中，实现配置覆盖。

## 6. 配置验证

- NvCraft 使用一个全局的 schema 来验证配置。
- 配置加载后，NvCraft 会使用此 schema 验证用户配置。
- 如果配置无效，将向用户显示错误或警告信息。

## 7. 配置迁移

- 当 NvCraft 的配置结构发生变化时，会自动进行迁移。
- 启动时会检查用户配置的版本，并应用必要的迁移。
- 迁移会更新用户配置文件到最新版本。

## 8. 配置文件监听

- NvCraft 会自动监听用户和项目配置文件的变化。
- 当检测到文件被修改时，配置会自动重新加载。
- 这允许用户在不重启 Neovim 的情况下动态修改配置。

## 9. 配置版本历史

- 每次修改用户或项目配置文件时，旧版本都会被备份。
- 备份文件存储在 `.history` 子目录中，并带有时间戳。
- 这为用户提供了一个简单的版本控制系统，方便回滚配置。
